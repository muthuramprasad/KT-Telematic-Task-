extends ../layout

block content
  .container.mt-4
    .d-flex.justify-content-between.align-items-center.mb-3
      h2 Asset Master List
      a.btn.btn-primary.btn-sm(href="/api/assets/add") Add Asset

    // Search + Filter Row
    form(method="GET" action="/api/assets/view")
      // Keep itemPerPage during submit
      input(type="hidden" name="itemPerPage", value=itemPerPage)

      .row.mb-3
        // Search by Name/Serial Number
        .col-md-3
          input.form-control(
            type="text",
            name="search",
            placeholder="Search name/serial number...",
            value=search
          )

        // Category Filter
        .col-md-3
          select.form-control(name="category")
            option(value="") All Categories
            each cat in categories
              option(value=cat.id, selected=(category == cat.id))= cat.name

        // Status Filter
        .col-md-3
          select.form-control(name="status")
            option(value="") All Statuses
            each assetStatus in assetStatuses
              option(value=assetStatus, selected=(status == assetStatus))= assetStatus.replace('_', ' ')

        .col-md-2
          button.btn.btn-success.w-100.btn-sm(type="submit") Filter

        .col-md-1
          a.btn.btn-secondary.w-100.btn-sm(href="/api/assets/view") Clear

    // Asset Table
    if assets.length
      table.table.table-bordered.table-striped
        thead
          tr
            th S.No
            th Asset Name
            th Serial Number
            th Category
            th Status
            th Current Holder
            th Actions
        tbody
          each asset, index in assets
            tr
              td= ((page - 1) * itemPerPage) + index + 1
              td= asset.name
              td= asset.serialNumber
              td= asset.category.name
              td
                - var statusBadge = 'bg-secondary';
                if asset.status === 'IN_STOCK'
                  - statusBadge = 'bg-success';
                else if asset.status === 'ISSUED'
                  - statusBadge = 'bg-warning';
                else if asset.status === 'SCRAPPED'
                  - statusBadge = 'bg-danger';
                else if asset.status === 'UNDER_REPAIR'
                  - statusBadge = 'bg-info';
                span.badge(class=statusBadge)= asset.status.replace('_', ' ')
              td
                if asset.currentHolder
                  = asset.currentHolder.firstname
                else
                  span.text-muted N/A
              td
                a.btn.btn-sm.btn-outline-warning(href=`/api/assets/edit/${asset.id}`) Edit
                a.btn.btn-sm.btn-outline-danger.ms-2(
                  href=`/api/assets/delete/${asset.id}?page=${page}&itemPerPage=${itemPerPage}&search=${search || ''}&status=${status || ''}&category=${category || ''}`
                ) Delete


      // Pagination
      if assets.length 
        nav.mt-3
          ul.pagination.justify-content-end

            // Prev Button
            li.page-item(class=(page <= 1 ? "disabled" : ""))
              a.page-link(
                href=`?page=${page-1}&itemPerPage=${itemPerPage}&search=${search || ''}&status=${status || ''}&category=${category || ''}`
              ) Prev

            // Page Numbers
            each num in [...Array(totalPages).keys()].map(n => n + 1)
              li.page-item(class=(page === num ? "active" : ""))
                a.page-link(
                  href=`?page=${num}&itemPerPage=${itemPerPage}&search=${search || ''}&status=${status || ''}&category=${category || ''}`
                ) #{num}

            // Next Button
            li.page-item(class=(page >= totalPages ? "disabled" : ""))
              a.page-link(
                href=`?page=${page+1}&itemPerPage=${itemPerPage}&search=${search || ''}&status=${status || ''}&category=${category || ''}`
              ) Next

    else
      p.text-center.text-muted.mt-4 No assets found.